<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Pegasus R0 / Generation time - EXERCISE • tidyabc</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Pegasus R0 / Generation time - EXERCISE">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">tidyabc</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/tidyabc.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/abc-adaptive.html">ABC Adaptive</a></li>
    <li><a class="dropdown-item" href="../articles/abc-smc.html">ABC Sequential Monte-Carlo</a></li>
    <li><a class="dropdown-item" href="../articles/s3-distributions.html">Tidy distribution functions</a></li>
    <li><a class="dropdown-item" href="../articles/scorer-functions.html">Tidy distribution functions</a></li>
    <li><a class="dropdown-item" href="../articles/sim_example.html">Pegasus R0 / Generation time - EXERCISE</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.svg" class="logo" alt=""><h1>Pegasus R0 / Generation time - EXERCISE</h1>
                        <h4 data-toc-skip class="author">Rob
Challen</h4>
            
      

      <div class="d-none name"><code>sim_example.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="simulation">Simulation<a class="anchor" aria-label="anchor" href="#simulation"></a>
</h2>
</div>
<div class="section level2">
<h2 id="setup-siumulation--">Setup siumulation —-<a class="anchor" aria-label="anchor" href="#setup-siumulation--"></a>
</h2>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sim_params</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  <span class="co"># A short generation time</span></span>
<span>  mean_gt <span class="op">=</span> <span class="fl">4</span>,</span>
<span>  sd_gt <span class="op">=</span> <span class="fl">2</span>,</span>
<span>  R0 <span class="op">=</span> <span class="fl">2</span>,</span>
<span>  I0 <span class="op">=</span> <span class="fl">10</span>,</span>
<span>  <span class="co"># Add a longish and very variable delay to symptoms</span></span>
<span>  p_symptomatic <span class="op">=</span> <span class="fl">0.3</span>,</span>
<span>  mean_onset <span class="op">=</span> <span class="fl">7</span>,</span>
<span>  sd_onset <span class="op">=</span> <span class="fl">5</span>,</span>
<span>  <span class="co"># and a slightly shorter delay to observation:</span></span>
<span>  <span class="co"># Only symptomatic cases are observed</span></span>
<span>  p_detected_given_symptoms <span class="op">=</span> <span class="fl">0.7</span>,</span>
<span>  mean_obs <span class="op">=</span> <span class="fl">5</span>,</span>
<span>  sd_obs <span class="op">=</span> <span class="fl">3</span>,</span>
<span>  <span class="co"># Observation cutoff:</span></span>
<span>  T_obs <span class="op">=</span> <span class="fl">40</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Run simulation ----</span></span>
<span></span>
<span><span class="va">sim_ip</span> <span class="op">=</span> <span class="fu">ggoutbreak</span><span class="fu">::</span><span class="fu"><a href="https://ai4ci.github.io/ggoutbreak/reference/make_gamma_ip.html" class="external-link">make_gamma_ip</a></span><span class="op">(</span></span>
<span>  median_of_mean <span class="op">=</span> <span class="va">sim_params</span><span class="op">$</span><span class="va">mean_gt</span>,</span>
<span>  median_of_sd <span class="op">=</span> <span class="va">sim_params</span><span class="op">$</span><span class="va">sd_gt</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">sim_params</span><span class="op">$</span><span class="va">r0</span> <span class="op">=</span> <span class="fu">ggoutbreak</span><span class="fu">::</span><span class="fu"><a href="https://ai4ci.github.io/ggoutbreak/reference/inv_wallinga_lipsitch.html" class="external-link">inv_wallinga_lipsitch</a></span><span class="op">(</span><span class="va">sim_params</span><span class="op">$</span><span class="va">R0</span>, <span class="va">sim_ip</span><span class="op">)</span></span>
<span></span>
<span><span class="va">truth</span> <span class="op">=</span> <span class="fu">ggoutbreak</span><span class="fu">::</span><span class="fu"><a href="https://ai4ci.github.io/ggoutbreak/reference/sim_branching_process.html" class="external-link">sim_branching_process</a></span><span class="op">(</span></span>
<span>  fn_Rt <span class="op">=</span> <span class="op">~</span> <span class="va">sim_params</span><span class="op">$</span><span class="va">R0</span>,</span>
<span>  fn_ip <span class="op">=</span> <span class="op">~</span><span class="va">sim_ip</span>,</span>
<span>  fn_imports <span class="op">=</span> \<span class="op">(</span><span class="va">t</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">t</span> <span class="op">==</span> <span class="fl">1</span>, <span class="va">sim_params</span><span class="op">$</span><span class="va">I0</span>, <span class="fl">0</span><span class="op">)</span>,</span>
<span>  max_time <span class="op">=</span> <span class="fl">40</span></span>
<span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## ....................complete</span></span>
<span><span class="co">## interfacer: development mode active (local function).</span></span></code></pre>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">delayed</span> <span class="op">=</span> <span class="va">truth</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">ggoutbreak</span><span class="fu">::</span><span class="fu"><a href="https://ai4ci.github.io/ggoutbreak/reference/sim_delay.html" class="external-link">sim_delay</a></span><span class="op">(</span></span>
<span>    p_fn <span class="op">=</span> <span class="op">~</span> <span class="va">sim_params</span><span class="op">$</span><span class="va">p_symptomatic</span>,</span>
<span>    delay_fn <span class="op">=</span> <span class="op">~</span> <span class="fu">ggoutbreak</span><span class="fu">::</span><span class="fu"><a href="https://ai4ci.github.io/ggoutbreak/reference/rgamma2.html" class="external-link">rgamma2</a></span><span class="op">(</span></span>
<span>      <span class="va">.x</span>,</span>
<span>      <span class="va">sim_params</span><span class="op">$</span><span class="va">mean_onset</span>,</span>
<span>      <span class="va">sim_params</span><span class="op">$</span><span class="va">sd_onset</span></span>
<span>    <span class="op">)</span>,</span>
<span>    input <span class="op">=</span> <span class="st">"time"</span>,</span>
<span>    output <span class="op">=</span> <span class="st">"symptom"</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">ggoutbreak</span><span class="fu">::</span><span class="fu"><a href="https://ai4ci.github.io/ggoutbreak/reference/sim_delay.html" class="external-link">sim_delay</a></span><span class="op">(</span></span>
<span>    p_fn <span class="op">=</span> \<span class="op">(</span><span class="va">t</span>, <span class="va">symptom</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">symptom</span>, <span class="va">sim_params</span><span class="op">$</span><span class="va">p_detected_given_symptoms</span>, <span class="fl">0</span><span class="op">)</span></span>
<span>    <span class="op">}</span>,</span>
<span>    delay_fn <span class="op">=</span> <span class="op">~</span> <span class="fu">ggoutbreak</span><span class="fu">::</span><span class="fu"><a href="https://ai4ci.github.io/ggoutbreak/reference/rgamma2.html" class="external-link">rgamma2</a></span><span class="op">(</span></span>
<span>      <span class="va">.x</span>,</span>
<span>      <span class="va">sim_params</span><span class="op">$</span><span class="va">mean_obs</span>,</span>
<span>      <span class="va">sim_params</span><span class="op">$</span><span class="va">sd_obs</span></span>
<span>    <span class="op">)</span>,</span>
<span>    input <span class="op">=</span> <span class="st">"symptom_time"</span>,</span>
<span>    output <span class="op">=</span> <span class="st">"observation"</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">observed</span> <span class="op">=</span> <span class="va">delayed</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">observation_time</span> <span class="op">&lt;</span> <span class="va">sim_params</span><span class="op">$</span><span class="cn">T</span><span class="op">)</span></span>
<span></span>
<span><span class="va">traced_contacts</span> <span class="op">=</span> <span class="va">observed</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter-joins.html" class="external-link">semi_join</a></span><span class="op">(</span><span class="va">observed</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"infector"</span> <span class="op">=</span> <span class="st">"id"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="section level3">
<h3 id="index-case-onset">Index case onset<a class="anchor" aria-label="anchor" href="#index-case-onset"></a>
</h3>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">index_case_onset</span> <span class="op">=</span> <span class="va">observed</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/transmute.html" class="external-link">transmute</a></span><span class="op">(</span>onset_time <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">floor</a></span><span class="op">(</span><span class="va">symptom_time</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">index_case_onset</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">onset_time</span><span class="op">)</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html" class="external-link">geom_histogram</a></span><span class="op">(</span>binwidth <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<p><img src="sim_example_files/figure-html/unnamed-chunk-2-1.png" class="r-plt" width="700"></p>
</div>
<div class="section level3">
<h3 id="delay-to-observation">Delay to observation<a class="anchor" aria-label="anchor" href="#delay-to-observation"></a>
</h3>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Data</span></span>
<span></span>
<span><span class="va">delay_distribution</span> <span class="op">=</span> <span class="va">observed</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/transmute.html" class="external-link">transmute</a></span><span class="op">(</span></span>
<span>  obs_delay <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">floor</a></span><span class="op">(</span><span class="va">observation_time</span><span class="op">)</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">floor</a></span><span class="op">(</span><span class="va">symptom_time</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">delay_distribution</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">obs_delay</span><span class="op">)</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html" class="external-link">geom_histogram</a></span><span class="op">(</span>binwidth <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">"symptom to observation"</span><span class="op">)</span></span></code></pre></div>
<p><img src="sim_example_files/figure-html/unnamed-chunk-3-1.png" class="r-plt" width="700"></p>
</div>
<div class="section level3">
<h3 id="observed-serial-interval">Observed serial interval<a class="anchor" aria-label="anchor" href="#observed-serial-interval"></a>
</h3>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">serial_pairs</span> <span class="op">=</span> <span class="va">observed</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">inner_join</a></span><span class="op">(</span></span>
<span>    <span class="va">traced_contacts</span>,</span>
<span>    by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"id"</span> <span class="op">=</span> <span class="st">"infector"</span><span class="op">)</span>,</span>
<span>    suffix <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">".1"</span>, <span class="st">".2"</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/transmute.html" class="external-link">transmute</a></span><span class="op">(</span></span>
<span>    serial_interval <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">floor</a></span><span class="op">(</span><span class="va">symptom_time.2</span><span class="op">)</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">floor</a></span><span class="op">(</span><span class="va">symptom_time.1</span><span class="op">)</span> <span class="co">#order known</span></span>
<span>    <span class="co"># serial_interval = abs(floor(symptom_time.2) - floor(symptom_time.1)) #order uncertain</span></span>
<span>  <span class="op">)</span> </span>
<span></span>
<span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">serial_pairs</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html" class="external-link">geom_histogram</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">serial_interval</span><span class="op">)</span>, binwidth <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">"symptom serial interval (given observed)"</span><span class="op">)</span></span></code></pre></div>
<p><img src="sim_example_files/figure-html/unnamed-chunk-4-1.png" class="r-plt" width="700"></p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">obsdata</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  onset <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">index_case_onset</span><span class="op">$</span><span class="va">onset_time</span><span class="op">)</span>,</span>
<span>  diff <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">delay_distribution</span><span class="op">$</span><span class="va">obs_delay</span><span class="op">)</span>,</span>
<span>  si <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">serial_pairs</span><span class="op">$</span><span class="va">serial_interval</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="model">Model<a class="anchor" aria-label="anchor" href="#model"></a>
</h2>
<p>Aim is to fit a model to all 3 aspects of the data simultaneously.
The model makes the following hard assumptions:</p>
<ul>
<li>constant exponential growth in infection times (hidden t_inf)</li>
<li>delayed onset to symptoms - gamma distributed (t_onset = t_inf +
onset_delay)</li>
<li>delayed observation of symptoms - gamma distributed (t_obs = onset +
obs_delay)</li>
<li>secondary case delayed by generation time (hidden t_inf2 = t_inf +
gt_delay)</li>
<li>secondary case symptom onset and observation as above (t_onset_2 /
t_obs_2)</li>
<li>cases only observed if t_obs / t_obs_2 within time window (0-T)</li>
</ul>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mtable><mtr><mtd columnalign="right" style="text-align: right"><msub><mi>t</mi><mrow><mi>m</mi><mi>a</mi><mi>x</mi></mrow></msub><mo>−</mo><msub><mi>T</mi><mrow><mi>i</mi><mi>n</mi><mi>f</mi></mrow></msub></mtd><mtd columnalign="left" style="text-align: left"><mo>∼</mo><mi>E</mi><mi>x</mi><mi>p</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>r</mi><mn>0</mn></msub><mo stretchy="true" form="postfix">)</mo></mrow></mtd></mtr><mtr><mtd columnalign="right" style="text-align: right"><mi>Δ</mi><msub><mi>T</mi><mrow><mi>i</mi><mi>n</mi><mi>f</mi><mo>→</mo><mi>o</mi><mi>n</mi><mi>s</mi><mi>e</mi><mi>t</mi></mrow></msub></mtd><mtd columnalign="left" style="text-align: left"><mo>∼</mo><mi>G</mi><mi>a</mi><mi>m</mi><mi>m</mi><mi>a</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>μ</mi><mrow><mi>o</mi><mi>n</mi><mi>s</mi><mi>e</mi><mi>t</mi></mrow></msub><mo>,</mo><msub><mi>σ</mi><mrow><mi>o</mi><mi>n</mi><mi>s</mi><mi>e</mi><mi>t</mi></mrow></msub><mo stretchy="true" form="postfix">)</mo></mrow></mtd></mtr><mtr><mtd columnalign="right" style="text-align: right"><mi>Δ</mi><msub><mi>T</mi><mrow><mi>o</mi><mi>n</mi><mi>s</mi><mi>e</mi><mi>t</mi><mo>→</mo><mi>o</mi><mi>b</mi><mi>s</mi></mrow></msub></mtd><mtd columnalign="left" style="text-align: left"><mo>∼</mo><mi>G</mi><mi>a</mi><mi>m</mi><mi>m</mi><mi>a</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>μ</mi><mrow><mi>o</mi><mi>b</mi><mi>s</mi></mrow></msub><mo>,</mo><msub><mi>σ</mi><mrow><mi>o</mi><mi>b</mi><mi>s</mi></mrow></msub><mo stretchy="true" form="postfix">)</mo></mrow></mtd></mtr><mtr><mtd columnalign="right" style="text-align: right"><mi>Δ</mi><msub><mi>T</mi><mrow><mi>g</mi><mi>t</mi></mrow></msub></mtd><mtd columnalign="left" style="text-align: left"><mo>∼</mo><mi>G</mi><mi>a</mi><mi>m</mi><mi>m</mi><mi>a</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>μ</mi><mrow><mi>g</mi><mi>t</mi></mrow></msub><mo>,</mo><msub><mi>σ</mi><mrow><mi>g</mi><mi>t</mi></mrow></msub><mo stretchy="true" form="postfix">)</mo></mrow></mtd></mtr><mtr><mtd columnalign="right" style="text-align: right"></mtd></mtr></mtable><annotation encoding="application/x-tex">
\begin{align}
t_{max} - T_{inf} &amp;\sim Exp(r_0) \\
\Delta T_{inf \rightarrow onset} &amp;\sim Gamma(\mu_{onset},\sigma_{onset}) \\
\Delta T_{onset \rightarrow obs} &amp;\sim Gamma(\mu_{obs},\sigma_{obs}) \\
\Delta T_{gt} &amp;\sim Gamma(\mu_{gt},\sigma_{gt}) \\
\end{align}
</annotation></semantics></math></p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mtable><mtr><mtd columnalign="right" style="text-align: right"><msub><mi>T</mi><mrow><mi>o</mi><mi>n</mi><mi>s</mi><mi>e</mi><mi>t</mi></mrow></msub></mtd><mtd columnalign="left" style="text-align: left"><mo>=</mo><msub><mi>T</mi><mrow><mi>i</mi><mi>n</mi><mi>f</mi></mrow></msub><mo>+</mo><mi>Δ</mi><msub><mi>T</mi><mrow><mi>i</mi><mi>n</mi><mi>f</mi><mo>→</mo><mi>o</mi><mi>n</mi><mi>s</mi><mi>e</mi><mi>t</mi></mrow></msub></mtd></mtr><mtr><mtd columnalign="right" style="text-align: right"><msub><mi>T</mi><mrow><mi>o</mi><mi>b</mi><mi>s</mi></mrow></msub></mtd><mtd columnalign="left" style="text-align: left"><mo>=</mo><msub><mi>T</mi><mrow><mi>o</mi><mi>n</mi><mi>s</mi><mi>e</mi><mi>t</mi></mrow></msub><mo>+</mo><mi>Δ</mi><msub><mi>T</mi><mrow><mi>o</mi><mi>n</mi><mi>s</mi><mi>e</mi><mi>t</mi><mo>→</mo><mi>o</mi><mi>b</mi><mi>s</mi></mrow></msub></mtd></mtr><mtr><mtd columnalign="right" style="text-align: right"><msub><mi>T</mi><mrow><mi>i</mi><mi>n</mi><msub><mi>f</mi><mn>2</mn></msub></mrow></msub></mtd><mtd columnalign="left" style="text-align: left"><mo>=</mo><msub><mi>T</mi><mrow><mi>i</mi><mi>n</mi><msub><mi>f</mi><mn>1</mn></msub></mrow></msub><mo>+</mo><mi>Δ</mi><msub><mi>T</mi><mrow><mi>g</mi><mi>t</mi></mrow></msub></mtd></mtr><mtr><mtd columnalign="right" style="text-align: right"><mi>Δ</mi><msub><mi>T</mi><mrow><mi>o</mi><mi>n</mi><mi>s</mi><mi>e</mi><msub><mi>t</mi><mn>1</mn></msub><mo>→</mo><mi>o</mi><mi>n</mi><mi>s</mi><mi>e</mi><msub><mi>t</mi><mn>2</mn></msub></mrow></msub></mtd><mtd columnalign="left" style="text-align: left"><mo>=</mo><mi>Δ</mi><msub><mi>T</mi><mrow><mi>g</mi><mi>t</mi></mrow></msub><mo>+</mo><mi>Δ</mi><msub><mi>T</mi><mrow><mi>i</mi><mi>n</mi><msub><mi>f</mi><mn>2</mn></msub><mo>→</mo><mi>o</mi><mi>n</mi><mi>s</mi><mi>e</mi><msub><mi>t</mi><mn>2</mn></msub></mrow></msub><mo>−</mo><mi>Δ</mi><msub><mi>T</mi><mrow><mi>i</mi><mi>n</mi><msub><mi>f</mi><mn>1</mn></msub><mo>→</mo><mi>o</mi><mi>n</mi><mi>s</mi><mi>e</mi><msub><mi>t</mi><mn>1</mn></msub></mrow></msub></mtd></mtr><mtr><mtd columnalign="right" style="text-align: right"></mtd></mtr></mtable><annotation encoding="application/x-tex">
\begin{align}
T_{onset} &amp;= T_{inf} + \Delta T_{inf \rightarrow onset} \\
T_{obs} &amp;= T_{onset} + \Delta T_{onset \rightarrow obs}\\
T_{inf_2} &amp;= T_{inf_1} + \Delta T_{gt} \\
\Delta T_{onset_1 \rightarrow onset_2} &amp;=  \Delta T_{gt} + \Delta T_{inf_2 \rightarrow onset_2} -  \Delta T_{inf_1 \rightarrow onset_1} \\
\end{align}
</annotation></semantics></math></p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mtable><mtr><mtd columnalign="right" style="text-align: right"><msub><mi>O</mi><mn>1</mn></msub></mtd><mtd columnalign="left" style="text-align: left"><mo>=</mo><mi>I</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>t</mi><mn>0</mn></msub><mo>≤</mo><msub><mi>T</mi><mrow><mi>o</mi><mi>n</mi><mi>s</mi><mi>e</mi><msub><mi>t</mi><mn>1</mn></msub></mrow></msub><mo>,</mo><msub><mi>T</mi><mrow><mi>o</mi><mi>b</mi><msub><mi>s</mi><mn>1</mn></msub></mrow></msub><mo>≤</mo><msub><mi>t</mi><mrow><mi>m</mi><mi>a</mi><mi>x</mi></mrow></msub><mo stretchy="true" form="postfix">)</mo></mrow></mtd></mtr><mtr><mtd columnalign="right" style="text-align: right"><msub><mi>O</mi><mrow><mn>1</mn><mo>,</mo><mn>2</mn></mrow></msub></mtd><mtd columnalign="left" style="text-align: left"><mo>=</mo><mi>I</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>O</mi><mn>1</mn></msub><mo>,</mo><msub><mi>t</mi><mn>0</mn></msub><mo>≤</mo><msub><mi>T</mi><mrow><mi>o</mi><mi>n</mi><mi>s</mi><mi>e</mi><msub><mi>t</mi><mn>2</mn></msub></mrow></msub><mo>,</mo><msub><mi>T</mi><mrow><mi>o</mi><mi>b</mi><msub><mi>s</mi><mn>2</mn></msub></mrow></msub><mo>≤</mo><msub><mi>t</mi><mrow><mi>m</mi><mi>a</mi><mi>x</mi></mrow></msub><mo stretchy="true" form="postfix">)</mo></mrow></mtd></mtr><mtr><mtd columnalign="right" style="text-align: right"><msub><mi>T</mi><mrow><mi>o</mi><mi>n</mi><mi>s</mi><mi>e</mi><msub><mi>t</mi><mn>1</mn></msub></mrow></msub><mo stretchy="false" form="prefix">|</mo><msub><mi>O</mi><mn>1</mn></msub></mtd><mtd columnalign="left" style="text-align: left"><mo>⇒</mo><mtext mathvariant="normal">primary case times</mtext></mtd></mtr><mtr><mtd columnalign="right" style="text-align: right"><mi>Δ</mi><msub><mi>T</mi><mrow><mi>o</mi><mi>n</mi><mi>s</mi><mi>e</mi><msub><mi>t</mi><mn>1</mn></msub><mo>→</mo><mi>o</mi><mi>b</mi><msub><mi>s</mi><mn>1</mn></msub></mrow></msub><mo stretchy="false" form="prefix">|</mo><msub><mi>O</mi><mn>1</mn></msub></mtd><mtd columnalign="left" style="text-align: left"><mo>⇒</mo><mtext mathvariant="normal">onset to interview delay</mtext></mtd></mtr><mtr><mtd columnalign="right" style="text-align: right"><mi>Δ</mi><msub><mi>T</mi><mrow><mi>o</mi><mi>n</mi><mi>s</mi><mi>e</mi><msub><mi>t</mi><mn>1</mn></msub><mo>→</mo><mi>o</mi><mi>n</mi><mi>s</mi><mi>e</mi><msub><mi>t</mi><mn>2</mn></msub></mrow></msub><mo stretchy="false" form="prefix">|</mo><msub><mi>O</mi><mrow><mn>1</mn><mo>,</mo><mn>2</mn></mrow></msub></mtd><mtd columnalign="left" style="text-align: left"><mo>⇒</mo><mtext mathvariant="normal">onset to onset serial interval</mtext></mtd></mtr><mtr><mtd columnalign="right" style="text-align: right"></mtd></mtr></mtable><annotation encoding="application/x-tex">
\begin{align}
O_1 &amp;= I(t_0 \le T_{onset_1}, T_{obs_1} \le t_{max}) \\
O_{1,2} &amp;= I(O_1, t_0 \le T_{onset_2}, T_{obs_2} \le t_{max})\\
T_{onset_1}|O_1 &amp;\Rightarrow \text{primary case times}\\
\Delta T_{onset_1 \rightarrow obs_1}|O_1 &amp;\Rightarrow \text{onset to interview delay}\\
\Delta T_{onset_1 \rightarrow onset_2}|O_{1,2} &amp;\Rightarrow \text{onset to onset serial interval}\\
\end{align}
</annotation></semantics></math></p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">n</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">observed</span><span class="op">)</span></span>
<span></span>
<span><span class="va">sim1_fn</span> <span class="op">=</span> <span class="fu">carrier</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/carrier/man/crate.html" class="external-link">crate</a></span><span class="op">(</span></span>
<span>  <span class="kw">function</span><span class="op">(</span><span class="va">r0</span>, <span class="va">mean_onset</span>, <span class="va">sd_onset</span>, <span class="va">mean_obs</span>, <span class="va">sd_obs</span>, <span class="va">mean_gt</span>, <span class="va">sd_gt</span>, <span class="va">R0</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span>    </span>
<span>    <span class="co"># Primary case infection time</span></span>
<span>    <span class="co"># exponentially distributed in time. Need to make sure we have enough samples </span></span>
<span>    <span class="co"># before t0 observation cutoff to account for early observed cases.</span></span>
<span>    <span class="co"># if (r0&gt;0) {</span></span>
<span>    <span class="co">#   t_inf_1 = T_obs - stats::rexp(n, r0)</span></span>
<span>    <span class="co"># } else {</span></span>
<span>    <span class="co">#   # Decling epidemic (quite unlikely)</span></span>
<span>    <span class="co">#   t_early = - stats::qgamma(0.99,mean_onset,sd_onset) # t starts at 0</span></span>
<span>    <span class="co">#   if (r0==0) {</span></span>
<span>    <span class="co">#     t_inf_1 = stats::runif(n,t_early,T_obs)</span></span>
<span>    <span class="co">#   } else {</span></span>
<span>    <span class="co">#     t_inf_1 = t_early+stats::rexp(n, -r0)</span></span>
<span>    <span class="co">#   } </span></span>
<span>    <span class="co"># }</span></span>
<span>    </span>
<span>    <span class="va">t_early</span> <span class="op">=</span> <span class="op">-</span> <span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/GammaDist.html" class="external-link">qgamma</a></span><span class="op">(</span><span class="fl">0.99</span>,<span class="va">mean_onset</span>,<span class="va">sd_onset</span><span class="op">)</span> <span class="co"># t starts at 0</span></span>
<span>    <span class="va">t_inf_1</span> <span class="op">=</span> <span class="fu">tidyabc</span><span class="fu">::</span><span class="fu"><a href="../reference/rexpgrowth.html">rexpgrowth</a></span><span class="op">(</span><span class="va">n</span>, <span class="va">r0</span>, <span class="va">T_obs</span>, <span class="va">t_early</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="va">onset_delay</span> <span class="op">=</span> <span class="fu">ggoutbreak</span><span class="fu">::</span><span class="fu"><a href="https://ai4ci.github.io/ggoutbreak/reference/rgamma2.html" class="external-link">rgamma2</a></span><span class="op">(</span><span class="va">n</span>, <span class="va">mean_onset</span>, <span class="va">sd_onset</span>, convex <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span>    <span class="va">obs_delay</span> <span class="op">=</span> <span class="fu">ggoutbreak</span><span class="fu">::</span><span class="fu"><a href="https://ai4ci.github.io/ggoutbreak/reference/rgamma2.html" class="external-link">rgamma2</a></span><span class="op">(</span><span class="va">n</span>, <span class="va">mean_obs</span>, <span class="va">sd_obs</span>, convex <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="va">t_onset_1</span> <span class="op">=</span> <span class="va">t_inf_1</span> <span class="op">+</span> <span class="va">onset_delay</span></span>
<span>    <span class="va">t_obs_1</span> <span class="op">=</span> <span class="va">t_onset_1</span> <span class="op">+</span> <span class="va">obs_delay</span></span>
<span>    </span>
<span>    <span class="co"># Primary case observations:</span></span>
<span>    <span class="co"># Onset after t0 and observed before T</span></span>
<span>    <span class="va">obs_1</span> <span class="op">=</span> <span class="va">t_obs_1</span> <span class="op">&lt;</span> <span class="va">T_obs</span> <span class="op">&amp;</span> <span class="va">t_onset_1</span> <span class="op">&gt;</span> <span class="fl">0</span></span>
<span>    </span>
<span>    <span class="va">t_inf_1</span> <span class="op">=</span> <span class="va">t_inf_1</span><span class="op">[</span><span class="va">obs_1</span><span class="op">]</span></span>
<span>    <span class="va">t_onset_1</span> <span class="op">=</span> <span class="va">t_onset_1</span><span class="op">[</span><span class="va">obs_1</span><span class="op">]</span></span>
<span>    <span class="va">t_obs_1</span> <span class="op">=</span> <span class="va">t_obs_1</span><span class="op">[</span><span class="va">obs_1</span><span class="op">]</span></span>
<span>    </span>
<span>    <span class="va">n1</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">t_inf_1</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="co"># Secondary case. Numbers of secondary cases are poission(R0). Could add </span></span>
<span>    <span class="co"># dispersion here and fit it also</span></span>
<span>    <span class="co"># Only observed primary will be observed secondary so we can restrict to </span></span>
<span>    <span class="co"># observed subset</span></span>
<span>    <span class="co"># browser()</span></span>
<span>    <span class="va">case_2ary</span> <span class="op">=</span> <span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/Poisson.html" class="external-link">rpois</a></span><span class="op">(</span><span class="va">n1</span>,<span class="va">R0</span><span class="op">)</span></span>
<span>    <span class="va">index_1ary</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_along</a></span><span class="op">(</span><span class="va">case_2ary</span><span class="op">)</span>, <span class="va">case_2ary</span><span class="op">)</span></span>
<span>    <span class="va">n2</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">index_1ary</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="va">gt_delay</span> <span class="op">=</span> <span class="fu">ggoutbreak</span><span class="fu">::</span><span class="fu"><a href="https://ai4ci.github.io/ggoutbreak/reference/rgamma2.html" class="external-link">rgamma2</a></span><span class="op">(</span><span class="va">n2</span>, <span class="va">mean_gt</span>, <span class="va">sd_gt</span>, convex <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span>    <span class="va">onset_delay_2</span> <span class="op">=</span> <span class="fu">ggoutbreak</span><span class="fu">::</span><span class="fu"><a href="https://ai4ci.github.io/ggoutbreak/reference/rgamma2.html" class="external-link">rgamma2</a></span><span class="op">(</span><span class="va">n2</span>, <span class="va">mean_onset</span>, <span class="va">sd_onset</span>, convex <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span>    <span class="va">obs_delay_2</span> <span class="op">=</span> <span class="fu">ggoutbreak</span><span class="fu">::</span><span class="fu"><a href="https://ai4ci.github.io/ggoutbreak/reference/rgamma2.html" class="external-link">rgamma2</a></span><span class="op">(</span><span class="va">n2</span>, <span class="va">mean_obs</span>, <span class="va">sd_obs</span>, convex <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="va">t_inf_2</span> <span class="op">=</span> <span class="va">t_inf_1</span><span class="op">[</span><span class="va">index_1ary</span><span class="op">]</span> <span class="op">+</span> <span class="va">gt_delay</span></span>
<span>    <span class="va">t_onset_2</span> <span class="op">=</span> <span class="va">t_inf_2</span> <span class="op">+</span> <span class="va">onset_delay_2</span></span>
<span>    <span class="va">t_obs_2</span> <span class="op">=</span> <span class="va">t_onset_2</span> <span class="op">+</span> <span class="va">obs_delay_2</span></span>
<span>    </span>
<span>    <span class="co"># order dependent</span></span>
<span>    <span class="va">serial_interval</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">floor</a></span><span class="op">(</span><span class="va">t_onset_2</span><span class="op">)</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">floor</a></span><span class="op">(</span><span class="va">t_onset_1</span><span class="op">[</span><span class="va">index_1ary</span><span class="op">]</span><span class="op">)</span></span>
<span>    <span class="co"># order independent</span></span>
<span>    <span class="co"># serial_interval = abs(floor(t_onset_2) - floor(t_onset_1[index_1ary]))</span></span>
<span>    </span>
<span>    <span class="co"># Secondary case observations</span></span>
<span>    <span class="va">obs_2</span> <span class="op">=</span> <span class="va">t_obs_2</span> <span class="op">&lt;</span> <span class="va">T_obs</span> <span class="op">&amp;</span> <span class="va">t_onset_2</span> <span class="op">&gt;</span> <span class="fl">0</span></span>
<span>    </span>
<span>    <span class="va">serial_interval</span> <span class="op">=</span> <span class="va">serial_interval</span><span class="op">[</span><span class="va">obs_2</span><span class="op">]</span></span>
<span>    <span class="va">t_onset_2</span> <span class="op">=</span> <span class="va">t_onset_2</span><span class="op">[</span><span class="va">obs_2</span><span class="op">]</span></span>
<span>    </span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>      onset <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">floor</a></span><span class="op">(</span><span class="va">t_onset_1</span><span class="op">)</span>,</span>
<span>      diff <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">floor</a></span><span class="op">(</span><span class="va">t_obs_1</span><span class="op">)</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">floor</a></span><span class="op">(</span><span class="va">t_onset_1</span><span class="op">)</span>,</span>
<span>      si <span class="op">=</span> <span class="va">serial_interval</span></span>
<span>    <span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span>,</span>
<span>  T_obs <span class="op">=</span> <span class="va">sim_params</span><span class="op">$</span><span class="va">T_obs</span>,</span>
<span>  n<span class="op">=</span><span class="va">n</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">scorer1_fn</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">simdata</span>, <span class="va">obsdata</span><span class="op">)</span> <span class="op">{</span></span>
<span>  </span>
<span>  <span class="va">onset</span> <span class="op">=</span> <span class="fu"><a href="../reference/calculate_wasserstein.html">calculate_wasserstein</a></span><span class="op">(</span><span class="va">obsdata</span><span class="op">$</span><span class="va">onset</span>, <span class="va">simdata</span><span class="op">$</span><span class="va">onset</span><span class="op">)</span></span>
<span>  <span class="va">diff</span> <span class="op">=</span> <span class="fu"><a href="../reference/calculate_wasserstein.html">calculate_wasserstein</a></span><span class="op">(</span><span class="va">obsdata</span><span class="op">$</span><span class="va">diff</span>, <span class="va">simdata</span><span class="op">$</span><span class="va">diff</span><span class="op">)</span></span>
<span>  <span class="va">si</span> <span class="op">=</span> <span class="fu"><a href="../reference/calculate_wasserstein.html">calculate_wasserstein</a></span><span class="op">(</span><span class="va">obsdata</span><span class="op">$</span><span class="va">si</span>, <span class="va">simdata</span><span class="op">$</span><span class="va">si</span><span class="op">)</span></span>
<span>  <span class="va">mad_si</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">obsdata</span><span class="op">$</span><span class="va">si</span><span class="op">)</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">simdata</span><span class="op">$</span><span class="va">si</span><span class="op">)</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    sim_onset <span class="op">=</span> <span class="va">onset</span>,</span>
<span>    sim_diff <span class="op">=</span> <span class="va">diff</span>,</span>
<span>    sim_si<span class="op">=</span><span class="va">si</span>,</span>
<span>    sim_mad_si <span class="op">=</span> <span class="va">mad_si</span></span>
<span>  <span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># make the serial interval fitting much more important:</span></span>
<span><span class="va">scoreweights1</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>    sim_onset <span class="op">=</span> <span class="fl">2</span>,</span>
<span>    sim_diff <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>    sim_si <span class="op">=</span> <span class="fl">3</span>,</span>
<span>    sim_mad_si <span class="op">=</span> <span class="fl">3</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">test</span> <span class="op">=</span> <span class="fu">tidyabc</span><span class="fu">::</span><span class="fu"><a href="../reference/test_simulation.html">test_simulation</a></span><span class="op">(</span></span>
<span>  sim_fn <span class="op">=</span> <span class="va">sim1_fn</span>, </span>
<span>  scorer_fn <span class="op">=</span> <span class="va">scorer1_fn</span>,</span>
<span>  params <span class="op">=</span> <span class="va">sim_params</span>,</span>
<span>  obsdata <span class="op">=</span> <span class="va">obsdata</span></span>
<span>  <span class="co"># debug=TRUE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># .gg_hist(test$obsdata$onset)</span></span></code></pre></div>
<div class="section level3">
<h3 id="scoring">Scoring<a class="anchor" aria-label="anchor" href="#scoring"></a>
</h3>
<p>We are going to fit the model in a custom ABC with rejection
framework</p>
<p>I’m assessing model fits to the data using an earth movers distance
at the level of individual’s observed times versus simulations observed
times. Given that simulations cutoff different numbers of people I have
to match the size of the simulation and observed data</p>
</div>
<div class="section level3">
<h3 id="priors">Priors<a class="anchor" aria-label="anchor" href="#priors"></a>
</h3>
<p>Use a set of uninformative priors. RO is derived from
Wallinga-Lipsitch, Gamma distributions hyperparameters constrained so
that they are convex:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">priors</span> <span class="op">=</span> <span class="fu"><a href="../reference/priors.html">priors</a></span><span class="op">(</span></span>
<span>  <span class="va">r0</span> <span class="op">~</span> <span class="fu">unif</span><span class="op">(</span><span class="op">-</span><span class="fl">0.1</span>, <span class="fl">0.7</span><span class="op">)</span>,</span>
<span>  <span class="va">mean_onset</span> <span class="op">~</span> <span class="fu">unif</span><span class="op">(</span><span class="fl">0</span>, <span class="fl">12</span><span class="op">)</span>,</span>
<span>  <span class="va">sd_onset</span> <span class="op">~</span> <span class="fu">unif</span><span class="op">(</span><span class="fl">0</span>, <span class="fl">8</span><span class="op">)</span>,</span>
<span>  <span class="va">mean_obs</span> <span class="op">~</span> <span class="fu">unif</span><span class="op">(</span><span class="fl">0</span>, <span class="fl">12</span><span class="op">)</span>,</span>
<span>  <span class="va">sd_obs</span> <span class="op">~</span> <span class="fu">unif</span><span class="op">(</span><span class="fl">0</span>, <span class="fl">8</span><span class="op">)</span>,</span>
<span>  <span class="va">mean_gt</span> <span class="op">~</span> <span class="fu">unif</span><span class="op">(</span><span class="fl">0</span>, <span class="fl">12</span><span class="op">)</span>,</span>
<span>  <span class="va">sd_gt</span> <span class="op">~</span> <span class="fu">unif</span><span class="op">(</span><span class="fl">0</span>, <span class="fl">8</span><span class="op">)</span>,</span>
<span>  <span class="va">R0</span> <span class="op">~</span> <span class="op">(</span><span class="fl">1</span><span class="op">+</span><span class="va">r0</span><span class="op">*</span><span class="va">sd_gt</span><span class="op">^</span><span class="fl">2</span><span class="op">/</span><span class="va">mean_gt</span><span class="op">)</span> <span class="op">^</span> <span class="op">(</span><span class="va">mean_gt</span><span class="op">^</span><span class="fl">2</span> <span class="op">/</span> <span class="va">sd_gt</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span>,</span>
<span>  <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/is.finite.html" class="external-link">is.finite</a></span><span class="op">(</span><span class="va">R0</span><span class="op">)</span> <span class="op">&amp;</span> <span class="va">R0</span> <span class="op">&gt;</span> <span class="fl">0</span>,</span>
<span>  <span class="op">~</span> <span class="va">mean_onset</span> <span class="op">&gt;</span> <span class="va">sd_onset</span>,</span>
<span>  <span class="op">~</span> <span class="va">mean_obs</span> <span class="op">&gt;</span> <span class="va">sd_obs</span>,</span>
<span>  <span class="op">~</span> <span class="va">mean_gt</span> <span class="op">&gt;</span> <span class="va">sd_gt</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">priors</span></span></code></pre></div>
<pre><code><span><span class="co">## Parameters: </span></span>
<span><span class="co">## * r0: unif(min = -0.1, max = 0.7)</span></span>
<span><span class="co">## * mean_onset: unif(min = 0, max = 12)</span></span>
<span><span class="co">## * sd_onset: unif(min = 0, max = 8)</span></span>
<span><span class="co">## * mean_obs: unif(min = 0, max = 12)</span></span>
<span><span class="co">## * sd_obs: unif(min = 0, max = 8)</span></span>
<span><span class="co">## * mean_gt: unif(min = 0, max = 12)</span></span>
<span><span class="co">## * sd_gt: unif(min = 0, max = 8)</span></span>
<span><span class="co">## Constraints:</span></span>
<span><span class="co">## * is.finite(R0) &amp; R0 &gt; 0</span></span>
<span><span class="co">## * mean_onset &gt; sd_onset</span></span>
<span><span class="co">## * mean_obs &gt; sd_obs</span></span>
<span><span class="co">## * mean_gt &gt; sd_gt</span></span>
<span><span class="co">## Derived values:</span></span>
<span><span class="co">## * R0 = (1 + r0 * sd_gt^2/mean_gt)^(mean_gt^2/sd_gt^2)</span></span></code></pre>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">abc_fit</span> <span class="op">=</span> <span class="fu"><a href="../reference/abc_rejection.html">abc_rejection</a></span><span class="op">(</span></span>
<span>  obsdata <span class="op">=</span> <span class="va">obsdata</span>,</span>
<span>  priors_list <span class="op">=</span> <span class="va">priors</span>,</span>
<span>  sim_fn <span class="op">=</span> <span class="va">sim1_fn</span>,</span>
<span>  scorer_fn <span class="op">=</span> <span class="va">scorer1_fn</span>,</span>
<span>  n_sims <span class="op">=</span> <span class="fl">1000000</span>,</span>
<span>  acceptance_rate <span class="op">=</span> <span class="fl">0.001</span>,</span>
<span>  parallel <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  scoreweights <span class="op">=</span> <span class="va">scoreweights1</span></span>
<span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## ABC rejection, 1 wave.</span></span></code></pre>
<pre><code><span><span class="co">## Warning in stats::qnorm(q, -0.205013900337245, 0.0663277312263509): NaNs</span></span>
<span><span class="co">## produced</span></span></code></pre>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">abc_fit</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## ABC rejection fit: single wave</span></span>
<span><span class="co">## Parameter estimates:</span></span>
<span><span class="co">## <span style="color: #949494;"># A tibble: 8 × 4</span></span></span>
<span><span class="co">## <span style="color: #949494;"># Groups:   param [8]</span></span></span>
<span><span class="co">##   param      mean_sd       median_95_CrI            ESS</span></span>
<span><span class="co">##   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span> R0         2.227 ± 0.545 2.115 [1.467 — 3.490]   591.</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span> mean_gt    5.261 ± 1.681 4.938 [2.196 — 9.861]   591.</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">3</span> mean_obs   6.230 ± 1.903 6.032 [2.837 — 10.770]  591.</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">4</span> mean_onset 8.112 ± 1.953 8.067 [3.408 — 11.686]  591.</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">5</span> r0         0.186 ± 0.030 0.184 [0.121 — 0.268]   591.</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">6</span> sd_gt      3.696 ± 2.175 3.508 [0.240 — 7.721]   591.</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">7</span> sd_obs     4.491 ± 1.863 4.412 [1.108 — 7.779]   591.</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">8</span> sd_onset   5.094 ± 1.396 5.012 [2.149 — 7.753]   591.</span></span></code></pre>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">abc_fit</span>, truth <span class="op">=</span> <span class="va">sim_params</span><span class="op">)</span></span></code></pre></div>
<p><img src="sim_example_files/figure-html/unnamed-chunk-10-1.png" class="r-plt" width="700"></p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">smc_fit</span> <span class="op">=</span> <span class="fu"><a href="../reference/abc_smc.html">abc_smc</a></span><span class="op">(</span></span>
<span>  obsdata <span class="op">=</span> <span class="va">obsdata</span>,</span>
<span>  priors_list <span class="op">=</span> <span class="va">priors</span>,</span>
<span>  sim_fn <span class="op">=</span> <span class="va">sim1_fn</span>,</span>
<span>  scorer_fn <span class="op">=</span> <span class="va">scorer1_fn</span>,</span>
<span>  n_sims <span class="op">=</span> <span class="fl">8000</span>,</span>
<span>  acceptance_rate <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>  <span class="co">#debug_errors = TRUE,</span></span>
<span>  parallel <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  scoreweights <span class="op">=</span> <span class="va">scoreweights1</span></span>
<span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## ABC-SMC</span></span></code></pre>
<pre><code><span><span class="co">## Warning in stats::qnorm(q, -0.18810727283479, 0.0594144584708982): NaNs</span></span>
<span><span class="co">## produced</span></span></code></pre>
<pre><code><span><span class="co">## SMC waves:  <span style="color: #00BB00;">■                               </span>   1% | wave 1 ETA:  5m</span></span></code></pre>
<pre><code><span><span class="co">## SMC waves:  <span style="color: #00BB00;">■■                              </span>   2% | wave 2 ETA:  5m</span></span></code></pre>
<pre><code><span><span class="co">## SMC waves:  <span style="color: #00BB00;">■■                              </span>   4% | wave 3 ETA:  5m</span></span></code></pre>
<pre><code><span><span class="co">## SMC waves:  <span style="color: #00BB00;">■■■                             </span>   7% | wave 4 ETA:  5m</span></span></code></pre>
<pre><code><span><span class="co">## SMC waves:  <span style="color: #00BB00;">■■■■                            </span>   9% | wave 5 ETA:  5m</span></span></code></pre>
<pre><code><span><span class="co">## SMC waves:  <span style="color: #00BB00;">■■■■                            </span>  12% | wave 6 ETA:  4m</span></span></code></pre>
<pre><code><span><span class="co">## SMC waves:  <span style="color: #00BB00;">■■■■■                           </span>  14% | wave 7 ETA:  4m</span></span></code></pre>
<pre><code><span><span class="co">## SMC waves:  <span style="color: #00BB00;">■■■■■■                          </span>  17% | wave 8 ETA:  4m</span></span></code></pre>
<pre><code><span><span class="co">## SMC waves:  <span style="color: #00BB00;">■■■■■■■                         </span>  19% | wave 9 ETA:  4m</span></span></code></pre>
<pre><code><span><span class="co">## SMC waves:  <span style="color: #00BB00;">■■■■■■■■                        </span>  22% | wave 10 ETA:  4m</span></span></code></pre>
<pre><code><span><span class="co">## SMC waves:  <span style="color: #00BB00;">■■■■■■■■                        </span>  25% | wave 11 ETA:  4m</span></span></code></pre>
<pre><code><span><span class="co">## SMC waves:  <span style="color: #00BB00;">■■■■■■■■■                       </span>  27% | wave 12 ETA:  4m</span></span></code></pre>
<pre><code><span><span class="co">## SMC waves:  <span style="color: #00BB00;">■■■■■■■■■■                      </span>  30% | wave 13 ETA:  4m</span></span></code></pre>
<pre><code><span><span class="co">## SMC waves:  <span style="color: #00BB00;">■■■■■■■■■■■                     </span>  32% | wave 14 ETA:  3m</span></span></code></pre>
<pre><code><span><span class="co">## SMC waves:  <span style="color: #00BB00;">■■■■■■■■■■■                     </span>  35% | wave 15 ETA:  3m</span></span></code></pre>
<pre><code><span><span class="co">## SMC waves:  <span style="color: #00BB00;">■■■■■■■■■■■■                    </span>  38% | wave 16 ETA:  3m</span></span></code></pre>
<pre><code><span><span class="co">## SMC waves:  <span style="color: #00BB00;">■■■■■■■■■■■■■                   </span>  40% | wave 17 ETA:  3m</span></span></code></pre>
<pre><code><span><span class="co">## SMC waves:  <span style="color: #00BB00;">■■■■■■■■■■■■■■                  </span>  43% | wave 18 ETA:  3m</span></span></code></pre>
<pre><code><span><span class="co">## SMC waves:  <span style="color: #00BB00;">■■■■■■■■■■■■■■■                 </span>  46% | wave 19 ETA:  3m</span></span></code></pre>
<pre><code><span><span class="co">## Converged on wave: 20</span></span></code></pre>
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">smc_fit</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## ABC SMC fit: 20 waves - (converged)</span></span>
<span><span class="co">## Parameter estimates:</span></span>
<span><span class="co">## <span style="color: #949494;"># A tibble: 8 × 4</span></span></span>
<span><span class="co">## <span style="color: #949494;"># Groups:   param [8]</span></span></span>
<span><span class="co">##   param      mean_sd       median_95_CrI            ESS</span></span>
<span><span class="co">##   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span> R0         2.101 ± 0.289 2.062 [1.605 — 2.723]  <span style="text-decoration: underline;">6</span>328.</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span> mean_gt    5.168 ± 1.119 5.040 [2.992 — 8.360]  <span style="text-decoration: underline;">6</span>328.</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">3</span> mean_obs   5.468 ± 1.331 5.264 [3.129 — 9.261]  <span style="text-decoration: underline;">6</span>328.</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">4</span> mean_onset 7.159 ± 1.574 7.035 [3.888 — 11.027] <span style="text-decoration: underline;">6</span>328.</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">5</span> r0         0.181 ± 0.020 0.180 [0.133 — 0.238]  <span style="text-decoration: underline;">6</span>328.</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">6</span> sd_gt      3.947 ± 1.666 3.972 [0.552 — 7.404]  <span style="text-decoration: underline;">6</span>328.</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">7</span> sd_obs     3.840 ± 1.479 3.649 [1.324 — 7.300]  <span style="text-decoration: underline;">6</span>328.</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">8</span> sd_onset   4.662 ± 1.089 4.558 [2.456 — 7.329]  <span style="text-decoration: underline;">6</span>328.</span></span></code></pre>
<div class="sourceCode" id="cb44"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">smc_fit</span>,truth <span class="op">=</span> <span class="va">sim_params</span><span class="op">)</span></span></code></pre></div>
<p><img src="sim_example_files/figure-html/unnamed-chunk-12-1.png" class="r-plt" width="700"></p>
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_evolution.html">plot_evolution</a></span><span class="op">(</span><span class="va">smc_fit</span>,truth <span class="op">=</span> <span class="va">sim_params</span><span class="op">)</span></span></code></pre></div>
<p><img src="sim_example_files/figure-html/unnamed-chunk-12-2.png" class="r-plt" width="700"></p>
<div class="sourceCode" id="cb46"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">adaptive_fit</span> <span class="op">=</span> <span class="fu"><a href="../reference/abc_adaptive.html">abc_adaptive</a></span><span class="op">(</span></span>
<span>  obsdata <span class="op">=</span> <span class="va">obsdata</span>,</span>
<span>  priors_list <span class="op">=</span> <span class="va">priors</span>,</span>
<span>  sim_fn <span class="op">=</span> <span class="va">sim1_fn</span>,</span>
<span>  scorer_fn <span class="op">=</span> <span class="va">scorer1_fn</span>,</span>
<span>  n_sims <span class="op">=</span> <span class="fl">4000</span>,</span>
<span>  acceptance_rate <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>  <span class="co"># debug_errors = TRUE,</span></span>
<span>  parallel <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  scoreweights <span class="op">=</span> <span class="va">scoreweights1</span></span>
<span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## ABC-Adaptive</span></span></code></pre>
<pre><code><span><span class="co">## Warning in stats::qnorm(q, -0.206791663418369, 0.0654413385144222): NaNs</span></span>
<span><span class="co">## produced</span></span></code></pre>
<pre><code><span><span class="co">## Adaptive waves:  <span style="color: #00BB00;">■                               </span>   0% | wave 1 ETA:  6m</span></span></code></pre>
<pre><code><span><span class="co">## Adaptive waves:  <span style="color: #00BB00;">■                               </span>   1% | wave 2 ETA:  5m</span></span></code></pre>
<pre><code><span><span class="co">## Adaptive waves:  <span style="color: #00BB00;">■■                              </span>   2% | wave 4 ETA:  5m</span></span></code></pre>
<pre><code><span><span class="co">## Adaptive waves:  <span style="color: #00BB00;">■■                              </span>   3% | wave 6 ETA:  5m</span></span></code></pre>
<pre><code><span><span class="co">## Adaptive waves:  <span style="color: #00BB00;">■■                              </span>   4% | wave 7 ETA:  5m</span></span></code></pre>
<pre><code><span><span class="co">## Adaptive waves:  <span style="color: #00BB00;">■■■                             </span>   5% | wave 9 ETA:  5m</span></span></code></pre>
<pre><code><span><span class="co">## Adaptive waves:  <span style="color: #00BB00;">■■■                             </span>   6% | wave 10 ETA:  5m</span></span></code></pre>
<pre><code><span><span class="co">## Adaptive waves:  <span style="color: #00BB00;">■■■                             </span>   7% | wave 12 ETA:  5m</span></span></code></pre>
<pre><code><span><span class="co">## Converged on wave: 13</span></span></code></pre>
<div class="sourceCode" id="cb58"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">adaptive_fit</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## ABC adaptive fit: 13 waves - (converged)</span></span>
<span><span class="co">## Parameter estimates:</span></span>
<span><span class="co">## <span style="color: #949494;"># A tibble: 8 × 4</span></span></span>
<span><span class="co">## <span style="color: #949494;"># Groups:   param [8]</span></span></span>
<span><span class="co">##   param      mean_sd       median_95_CrI             ESS</span></span>
<span><span class="co">##   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span> R0         2.253 ± 0.674 2.111 [1.391 — 3.586]  <span style="text-decoration: underline;">15</span>023.</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span> mean_gt    4.707 ± 1.076 4.454 [2.492 — 9.342]  <span style="text-decoration: underline;">15</span>023.</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">3</span> mean_obs   6.791 ± 1.766 6.630 [2.416 — 10.930] <span style="text-decoration: underline;">15</span>023.</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">4</span> mean_onset 8.215 ± 1.730 8.003 [3.500 — 11.609] <span style="text-decoration: underline;">15</span>023.</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">5</span> r0         0.195 ± 0.044 0.192 [0.069 — 0.323]  <span style="text-decoration: underline;">15</span>023.</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">6</span> sd_gt      2.879 ± 1.420 2.858 [0.306 — 6.634]  <span style="text-decoration: underline;">15</span>023.</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">7</span> sd_obs     4.060 ± 1.696 3.991 [0.723 — 7.516]  <span style="text-decoration: underline;">15</span>023.</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">8</span> sd_onset   4.767 ± 1.402 4.668 [1.489 — 7.601]  <span style="text-decoration: underline;">15</span>023.</span></span></code></pre>
<div class="sourceCode" id="cb60"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">adaptive_fit</span>,truth <span class="op">=</span> <span class="va">sim_params</span><span class="op">)</span></span></code></pre></div>
<p><img src="sim_example_files/figure-html/unnamed-chunk-14-1.png" class="r-plt" width="700"></p>
<div class="sourceCode" id="cb61"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_evolution.html">plot_evolution</a></span><span class="op">(</span><span class="va">adaptive_fit</span>,truth <span class="op">=</span> <span class="va">sim_params</span><span class="op">)</span></span></code></pre></div>
<p><img src="sim_example_files/figure-html/unnamed-chunk-14-2.png" class="r-plt" width="700"></p>
<div class="sourceCode" id="cb62"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_correlations.html">plot_correlations</a></span><span class="op">(</span><span class="va">adaptive_fit</span>,truth <span class="op">=</span> <span class="va">sim_params</span><span class="op">)</span> <span class="op">&amp;</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span></span>
<span>   axis.title.y <span class="op">=</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>angle<span class="op">=</span><span class="fl">70</span>,vjust<span class="op">=</span><span class="fl">0.1</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="sim_example_files/figure-html/unnamed-chunk-14-3.png" class="r-plt" width="700"></p>
<div class="sourceCode" id="cb63"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_convergence.html">plot_convergence</a></span><span class="op">(</span><span class="va">adaptive_fit</span><span class="op">)</span></span></code></pre></div>
<p><img src="sim_example_files/figure-html/unnamed-chunk-14-4.png" class="r-plt" width="700"></p>
<div class="sourceCode" id="cb64"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_simulations.html">plot_simulations</a></span><span class="op">(</span><span class="va">obsdata</span>, <span class="va">adaptive_fit</span>, sim_fn <span class="op">=</span> <span class="va">sim1_fn</span><span class="op">)</span></span></code></pre></div>
<p><img src="sim_example_files/figure-html/unnamed-chunk-14-5.png" class="r-plt" width="700"></p>
<div class="sourceCode" id="cb65"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">priors2</span> <span class="op">=</span> <span class="fu"><a href="../reference/priors.html">priors</a></span><span class="op">(</span></span>
<span>  <span class="va">r0</span> <span class="op">~</span> <span class="fu">unif</span><span class="op">(</span><span class="op">-</span><span class="fl">0.1</span>, <span class="fl">0.7</span><span class="op">)</span>,</span>
<span>  <span class="va">mean_onset</span> <span class="op">~</span> <span class="fu">lnorm2</span><span class="op">(</span><span class="fl">7</span>, <span class="fl">2</span><span class="op">)</span>,</span>
<span>  <span class="va">sd_onset</span> <span class="op">~</span> <span class="fu">lnorm2</span><span class="op">(</span><span class="fl">5</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>  <span class="va">mean_obs</span> <span class="op">~</span> <span class="fu">lnorm2</span><span class="op">(</span><span class="fl">5</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>  <span class="va">sd_obs</span> <span class="op">~</span> <span class="fu">lnorm2</span><span class="op">(</span><span class="fl">3</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>  <span class="va">mean_gt</span> <span class="op">~</span> <span class="fu">unif</span><span class="op">(</span><span class="fl">0</span>, <span class="fl">12</span><span class="op">)</span>,</span>
<span>  <span class="va">sd_gt</span> <span class="op">~</span> <span class="fu">unif</span><span class="op">(</span><span class="fl">0</span>, <span class="fl">8</span><span class="op">)</span>,</span>
<span>  <span class="va">R0</span> <span class="op">~</span> <span class="op">(</span><span class="fl">1</span><span class="op">+</span><span class="va">r0</span><span class="op">*</span><span class="va">sd_gt</span><span class="op">^</span><span class="fl">2</span><span class="op">/</span><span class="va">mean_gt</span><span class="op">)</span> <span class="op">^</span> <span class="op">(</span><span class="va">mean_gt</span><span class="op">^</span><span class="fl">2</span> <span class="op">/</span> <span class="va">sd_gt</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span>,</span>
<span>  <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/is.finite.html" class="external-link">is.finite</a></span><span class="op">(</span><span class="va">R0</span><span class="op">)</span> <span class="op">&amp;</span> <span class="va">R0</span> <span class="op">&gt;</span> <span class="fl">0</span>,</span>
<span>  <span class="op">~</span> <span class="va">mean_onset</span> <span class="op">&gt;</span> <span class="va">sd_onset</span>,</span>
<span>  <span class="op">~</span> <span class="va">mean_obs</span> <span class="op">&gt;</span> <span class="va">sd_obs</span>,</span>
<span>  <span class="op">~</span> <span class="va">mean_gt</span> <span class="op">&gt;</span> <span class="va">sd_gt</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">priors2</span></span></code></pre></div>
<pre><code><span><span class="co">## Parameters: </span></span>
<span><span class="co">## * r0: unif(min = -0.1, max = 0.7)</span></span>
<span><span class="co">## * mean_onset: lnorm2(mean = 7, sd = 2)</span></span>
<span><span class="co">## * sd_onset: lnorm2(mean = 5, sd = 1)</span></span>
<span><span class="co">## * mean_obs: lnorm2(mean = 5, sd = 1)</span></span>
<span><span class="co">## * sd_obs: lnorm2(mean = 3, sd = 1)</span></span>
<span><span class="co">## * mean_gt: unif(min = 0, max = 12)</span></span>
<span><span class="co">## * sd_gt: unif(min = 0, max = 8)</span></span>
<span><span class="co">## Constraints:</span></span>
<span><span class="co">## * is.finite(R0) &amp; R0 &gt; 0</span></span>
<span><span class="co">## * mean_onset &gt; sd_onset</span></span>
<span><span class="co">## * mean_obs &gt; sd_obs</span></span>
<span><span class="co">## * mean_gt &gt; sd_gt</span></span>
<span><span class="co">## Derived values:</span></span>
<span><span class="co">## * R0 = (1 + r0 * sd_gt^2/mean_gt)^(mean_gt^2/sd_gt^2)</span></span></code></pre>
<div class="sourceCode" id="cb67"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">adaptive_fit2</span> <span class="op">=</span> <span class="fu"><a href="../reference/abc_adaptive.html">abc_adaptive</a></span><span class="op">(</span></span>
<span>  obsdata <span class="op">=</span> <span class="va">obsdata</span>,</span>
<span>  priors_list <span class="op">=</span> <span class="va">priors2</span>,</span>
<span>  sim_fn <span class="op">=</span> <span class="va">sim1_fn</span>,</span>
<span>  scorer_fn <span class="op">=</span> <span class="va">scorer1_fn</span>,</span>
<span>  n_sims <span class="op">=</span> <span class="fl">4000</span>,</span>
<span>  acceptance_rate <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>  <span class="co"># debug_errors = TRUE,</span></span>
<span>  parallel <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  scoreweights <span class="op">=</span> <span class="va">scoreweights1</span></span>
<span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## ABC-Adaptive</span></span></code></pre>
<pre><code><span><span class="co">## Warning in stats::qnorm(q, -0.200590853219569, 0.0666229038704867): NaNs</span></span>
<span><span class="co">## produced</span></span></code></pre>
<pre><code><span><span class="co">## Adaptive waves:  <span style="color: #00BB00;">■                               </span>   0% | wave 1 ETA:  6m</span></span></code></pre>
<pre><code><span><span class="co">## Adaptive waves:  <span style="color: #00BB00;">■                               </span>   2% | wave 3 ETA:  5m</span></span></code></pre>
<pre><code><span><span class="co">## Adaptive waves:  <span style="color: #00BB00;">■■                              </span>   3% | wave 5 ETA:  5m</span></span></code></pre>
<pre><code><span><span class="co">## Adaptive waves:  <span style="color: #00BB00;">■■                              </span>   3% | wave 6 ETA:  5m</span></span></code></pre>
<pre><code><span><span class="co">## Adaptive waves:  <span style="color: #00BB00;">■■                              </span>   5% | wave 8 ETA:  5m</span></span></code></pre>
<pre><code><span><span class="co">## Adaptive waves:  <span style="color: #00BB00;">■■■                             </span>   5% | wave 9 ETA:  5m</span></span></code></pre>
<pre><code><span><span class="co">## Adaptive waves:  <span style="color: #00BB00;">■■■                             </span>   7% | wave 11 ETA:  5m</span></span></code></pre>
<pre><code><span><span class="co">## Adaptive waves:  <span style="color: #00BB00;">■■■                             </span>   8% | wave 12 ETA:  5m</span></span></code></pre>
<pre><code><span><span class="co">## Adaptive waves:  <span style="color: #00BB00;">■■■■                            </span>   8% | wave 13 ETA:  5m</span></span></code></pre>
<pre><code><span><span class="co">## Adaptive waves:  <span style="color: #00BB00;">■■■■                            </span>   9% | wave 14 ETA:  5m</span></span></code></pre>
<pre><code><span><span class="co">## Converged on wave: 15</span></span></code></pre>
<div class="sourceCode" id="cb81"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">adaptive_fit2</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## ABC adaptive fit: 15 waves - (converged)</span></span>
<span><span class="co">## Parameter estimates:</span></span>
<span><span class="co">## <span style="color: #949494;"># A tibble: 8 × 4</span></span></span>
<span><span class="co">## <span style="color: #949494;"># Groups:   param [8]</span></span></span>
<span><span class="co">##   param      mean_sd       median_95_CrI             ESS</span></span>
<span><span class="co">##   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span> R0         2.158 ± 0.471 2.068 [1.474 — 3.161]  <span style="text-decoration: underline;">18</span>741.</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span> mean_gt    4.724 ± 0.976 4.430 [2.736 — 8.976]  <span style="text-decoration: underline;">18</span>741.</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">3</span> mean_obs   4.936 ± 0.781 4.860 [3.509 — 6.764]  <span style="text-decoration: underline;">18</span>741.</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">4</span> mean_onset 7.319 ± 1.483 7.055 [4.756 — 11.063] <span style="text-decoration: underline;">18</span>741.</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">5</span> r0         0.186 ± 0.035 0.184 [0.088 — 0.293]  <span style="text-decoration: underline;">18</span>741.</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">6</span> sd_gt      2.909 ± 1.453 2.812 [0.354 — 6.784]  <span style="text-decoration: underline;">18</span>741.</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">7</span> sd_obs     2.774 ± 0.712 2.735 [1.553 — 4.570]  <span style="text-decoration: underline;">18</span>741.</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">8</span> sd_onset   4.817 ± 0.805 4.798 [3.384 — 6.608]  <span style="text-decoration: underline;">18</span>741.</span></span></code></pre>
<div class="sourceCode" id="cb83"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">adaptive_fit2</span>,truth <span class="op">=</span> <span class="va">sim_params</span><span class="op">)</span></span></code></pre></div>
<p><img src="sim_example_files/figure-html/unnamed-chunk-17-1.png" class="r-plt" width="700"></p>
<div class="sourceCode" id="cb84"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_evolution.html">plot_evolution</a></span><span class="op">(</span><span class="va">adaptive_fit2</span>,truth <span class="op">=</span> <span class="va">sim_params</span><span class="op">)</span></span></code></pre></div>
<p><img src="sim_example_files/figure-html/unnamed-chunk-17-2.png" class="r-plt" width="700"></p>
<div class="sourceCode" id="cb85"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_correlations.html">plot_correlations</a></span><span class="op">(</span><span class="va">adaptive_fit2</span>,truth <span class="op">=</span> <span class="va">sim_params</span><span class="op">)</span></span></code></pre></div>
<p><img src="sim_example_files/figure-html/unnamed-chunk-17-3.png" class="r-plt" width="700"></p>
<div class="sourceCode" id="cb86"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_convergence.html">plot_convergence</a></span><span class="op">(</span><span class="va">adaptive_fit2</span><span class="op">)</span></span></code></pre></div>
<p><img src="sim_example_files/figure-html/unnamed-chunk-17-4.png" class="r-plt" width="700"></p>
<div class="sourceCode" id="cb87"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_simulations.html">plot_simulations</a></span><span class="op">(</span><span class="va">obsdata</span>, <span class="va">adaptive_fit2</span>, sim_fn <span class="op">=</span> <span class="va">sim1_fn</span><span class="op">)</span></span></code></pre></div>
<p><img src="sim_example_files/figure-html/unnamed-chunk-17-5.png" class="r-plt" width="700"></p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Robert Challen.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
