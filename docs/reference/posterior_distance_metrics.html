<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Generate a set of metrics from component scores — posterior_distance_metrics • tidyabc</title><!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png"><link rel="icon" type="”image/svg+xml”" href="../favicon.svg"><link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png"><link rel="icon" sizes="any" href="../favicon.ico"><link rel="manifest" href="../site.webmanifest"><!-- mathjax math --><script src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js" integrity="sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI=" crossorigin="anonymous"></script><script>
  window.MathJax = {
    chtml: {
      fontURL: "https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/output/chtml/fonts/woff-v2"
    }
  };
</script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Generate a set of metrics from component scores — posterior_distance_metrics"><meta name="description" content="The component scores are summary statistics output by the user supplied
scorer_fn as a named list. These can be variable in scale and location and
various options exist for combining them. They may need to be weighted by
scale as well as importance to get a model that works well. Such weights can
be input into the ABC algortihms using the scoreweights parameter. This
function helps provide diagnostics for calibrating the scoreweights
parameter."><meta property="og:description" content="The component scores are summary statistics output by the user supplied
scorer_fn as a named list. These can be variable in scale and location and
various options exist for combining them. They may need to be weighted by
scale as well as importance to get a model that works well. Such weights can
be input into the ABC algortihms using the scoreweights parameter. This
function helps provide diagnostics for calibrating the scoreweights
parameter."><meta property="og:image" content="https://ai4ci.github.io/tidyabc/logo.svg"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">tidyabc</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/tidyabc.html">Get started</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/abc-adaptive.html">ABC Adaptive</a></li>
    <li><a class="dropdown-item" href="../articles/abc-smc.html">ABC Sequential Monte-Carlo</a></li>
    <li><a class="dropdown-item" href="../articles/s3-distributions.html">Statistical distribution functions</a></li>
    <li><a class="dropdown-item" href="../articles/scorer-functions.html">Simulation, scoring and convergence functions</a></li>
    <li><a class="dropdown-item" href="../articles/sim-example.html">Early outbreak and Generation time</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/ai4ci/tidyabc/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.svg" class="logo" alt=""><h1>Generate a set of metrics from component scores</h1>
      <small class="dont-index">Source: <a href="https://github.com/ai4ci/tidyabc/blob/HEAD/R/abc-workflow.R" class="external-link"><code>R/abc-workflow.R</code></a></small>
      <div class="d-none name"><code>posterior_distance_metrics.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>The component scores are summary statistics output by the user supplied
<code>scorer_fn</code> as a named list. These can be variable in scale and location and
various options exist for combining them. They may need to be weighted by
scale as well as importance to get a model that works well. Such weights can
be input into the ABC algortihms using the <code>scoreweights</code> parameter. This
function helps provide diagnostics for calibrating the <code>scoreweights</code>
parameter.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">posterior_distance_metrics</span><span class="op">(</span><span class="va">posteriors_df</span>, obsscores <span class="op">=</span> <span class="cn">NULL</span>, keep_data <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-posteriors-df">posteriors_df<a class="anchor" aria-label="anchor" href="#arg-posteriors-df"></a></dt>
<dd><p>a dataframe of posteriors that have been selected by ABC
this may include columns for scores, weight and/or simulation outputs (
<code>abc_component_score</code>, <code>abc_summary_distance</code>, <code>abc_weight</code>, <code>abc_simulation</code>
) as well as columns matching the <code>priors</code> input specification.</p></dd>


<dt id="arg-obsscores">obsscores<a class="anchor" aria-label="anchor" href="#arg-obsscores"></a></dt>
<dd><p>Summary scores for the observational data. This will
be a named list, and is equivalent to the output of <code>scorer_fn</code>,
on the observed data. If not given typically it will be assumed to be all
zeros.</p></dd>


<dt id="arg-keep-data">keep_data<a class="anchor" aria-label="anchor" href="#arg-keep-data"></a></dt>
<dd><p>mainly for internal use this flag gives you the component
scores as a matrix</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>a list containing the following items:</p><ul><li><p><code>obsscores</code>: the input reference scores for each component</p></li>
<li><p><code>means</code>, <code>sds</code>: the means and sds of each score component</p></li>
<li><p><code>cov</code>: the covariance matrix for the scores</p></li>
<li><p><code>mad</code>: the mean absolute differences between the <code>simscores</code> and the <code>obsscores</code></p></li>
<li><p><code>rmsd</code>: the root mean squared differences between the <code>simscores</code> and the <code>obsscores</code></p></li>
<li><p><code>scoreweights</code>: a the <code>sds</code> divided by the <code>rmsd</code>. This weight should
mean that the weights of the  individual summary scores have similar influence
in the overall <code>abc_summary_distance</code> output once combined during SMC and
adaptive waves, especially if euclidean distances are involved.</p></li>
<li><p><code>simscores</code>: (if <code>keep_data</code>) a matrix of all the scores from these input
simulation posteriors</p></li>
<li><p><code>deltascores</code>: (if <code>keep_data</code>)  a matrix of the differences between <code>simscores</code> and <code>obsscores</code>.</p></li>
</ul></div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>Given a list of component scores \(S_s^{(i)} = (s_1^{(i)}, \dots, s_m^{(i)})\)
from \(n\) simulations and observed scores \(S_o = (s_1^{(o)}, \dots, s_m^{(o)})\),
this function calculates:</p><ul><li><p>The mean \(\mu_j\) and standard deviation \(\sigma_j\) of each score component \(j\):
$$
    \mu_j = \frac{1}{n}\sum_{i=1}^n s_j^{(i)}, \quad
    \sigma_j = \sqrt{\frac{1}{n-1}\sum_{i=1}^n (s_j^{(i)} - \mu_j)^2}
  $$</p></li>
<li><p>The covariance matrix \(\Sigma\) of the score components.</p></li>
<li><p>The root mean squared difference (RMSD) between simulated and observed scores for each component:
$$
    \text{RMSD}_j = \sqrt{\frac{1}{n}\sum_{i=1}^n (s_j^{(i)} - s_j^{(o)})^2}
  $$</p></li>
<li><p>A recommended vector of <code>scoreweights</code> \(w_j\), calculated as the ratio of the component's
standard deviation to its RMSD, normalized to sum to 1:
$$
    w_j = \frac{\sigma_j / \text{RMSD}_j}{\sum_{k=1}^m (\sigma_k / \text{RMSD}_k)}
  $$
These weights help balance the influence of different summary statistics in
the overall distance metric, especially when using Euclidean distance.</p></li>
</ul></div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">fit</span> <span class="op">=</span> <span class="fu"><a href="example_fns.html">example_rejection_fit</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> ABC rejection, 1 wave.</span>
<span class="r-in"><span><span class="va">metrics</span> <span class="op">=</span> <span class="fu">posterior_distance_metrics</span><span class="op">(</span><span class="va">fit</span><span class="op">$</span><span class="va">posteriors</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># other elements available but this is the most important and tells you what</span></span></span>
<span class="r-in"><span><span class="co"># the relative sizes of the component scores from `scorer_fn` in this sample.</span></span></span>
<span class="r-in"><span><span class="co"># If this is a sample from the prior then this gives us a way to judge the</span></span></span>
<span class="r-in"><span><span class="co"># most appropriate relative weighting of each component:</span></span></span>
<span class="r-in"><span><span class="va">metrics</span><span class="op">$</span><span class="va">scoreweights</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       A       B </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 0.57956 0.42044 </span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Robert Challen.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer></div>





  </body></html>

