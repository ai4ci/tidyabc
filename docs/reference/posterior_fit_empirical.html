<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Fit empirical distribution to posterior samples for generating more waves — posterior_fit_empirical • tidyabc</title><!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png"><link rel="icon" type="”image/svg+xml”" href="../favicon.svg"><link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png"><link rel="icon" sizes="any" href="../favicon.ico"><link rel="manifest" href="../site.webmanifest"><!-- mathjax math --><script src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js" integrity="sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI=" crossorigin="anonymous"></script><script>
  window.MathJax = {
    chtml: {
      fontURL: "https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/output/chtml/fonts/woff-v2"
    }
  };
</script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Fit empirical distribution to posterior samples for generating more waves — posterior_fit_empirical"><meta name="description" content='This function allows "updating" of the prior with an empirical posterior
distribution which will retain the bounds of the prior, and is effectively a
spline based transform of the prior distribution, based on the density of
data in prior space. This gives a clean density when data is close to a
prior distribution limit and work better than a standard density.'><meta property="og:description" content='This function allows "updating" of the prior with an empirical posterior
distribution which will retain the bounds of the prior, and is effectively a
spline based transform of the prior distribution, based on the density of
data in prior space. This gives a clean density when data is close to a
prior distribution limit and work better than a standard density.'><meta property="og:image" content="https://ai4ci.github.io/tidyabc/logo.svg"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">tidyabc</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/tidyabc.html">Get started</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/abc-adaptive.html">ABC Adaptive</a></li>
    <li><a class="dropdown-item" href="../articles/abc-smc.html">ABC Sequential Monte-Carlo</a></li>
    <li><a class="dropdown-item" href="../articles/s3-distributions.html">Statistical distribution functions</a></li>
    <li><a class="dropdown-item" href="../articles/scorer-functions.html">Simulation, scoring and convergence functions</a></li>
    <li><a class="dropdown-item" href="../articles/sim-example.html">Early outbreak and Generation time</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/ai4ci/tidyabc/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.svg" class="logo" alt=""><h1>Fit empirical distribution to posterior samples for generating more waves</h1>
      <small class="dont-index">Source: <a href="https://github.com/ai4ci/tidyabc/blob/HEAD/R/abc-workflow.R" class="external-link"><code>R/abc-workflow.R</code></a></small>
      <div class="d-none name"><code>posterior_fit_empirical.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>This function allows "updating" of the prior with an empirical posterior
distribution which will retain the bounds of the prior, and is effectively a
spline based transform of the prior distribution, based on the density of
data in prior space. This gives a clean density when data is close to a
prior distribution limit and work better than a standard density.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">posterior_fit_empirical</span><span class="op">(</span></span>
<span>  <span class="va">posteriors_df</span>,</span>
<span>  <span class="va">priors_list</span>,</span>
<span>  knots <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  bw <span class="op">=</span> <span class="fl">0.1</span>,</span>
<span>  widen_by <span class="op">=</span> <span class="fl">1</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-posteriors-df">posteriors_df<a class="anchor" aria-label="anchor" href="#arg-posteriors-df"></a></dt>
<dd><p>a dataframe of posteriors that have been selected by ABC
this may include columns for scores, weight and/or simulation outputs (
<code>abc_component_score</code>, <code>abc_summary_distance</code>, <code>abc_weight</code>, <code>abc_simulation</code>
) as well as columns matching the <code>priors</code> input specification.</p></dd>


<dt id="arg-priors-list">priors_list<a class="anchor" aria-label="anchor" href="#arg-priors-list"></a></dt>
<dd><p>a named list of priors specified as a <code>abc_prior</code> S3 object
(see <code><a href="priors.html">priors()</a></code>), this can include derived values as unnamed 2-sided
formulae, where the LHS of the formula will be assigned to the value of the
RHS, plus optionally a set of constraints as one sided formulae where the
RHS of the formulae will resolve to a boolean value.</p></dd>


<dt id="arg-knots">knots<a class="anchor" aria-label="anchor" href="#arg-knots"></a></dt>
<dd><p>the number of knots to model the CDF with. Optional, and will be
typically inferred from the data size. Small numbers tend to work better if
we expect the distribution to be unimodal.</p></dd>


<dt id="arg-bw">bw<a class="anchor" aria-label="anchor" href="#arg-bw"></a></dt>
<dd><p>for Adaptive ABC data distributions are smoothed before modelling
the CDF. Over smoothing can reduce convergence rate, under-smoothing may result
in noisy posterior estimates, and appearance of local modes.
This is a proportion of the ESS and defaults to 0.1.</p></dd>


<dt id="arg-widen-by">widen_by<a class="anchor" aria-label="anchor" href="#arg-widen-by"></a></dt>
<dd><p>change the dispersion of proposal distribution in ABC
adaptive, preserving the median. This is akin to a nonlinear,
heteroscedastic random walk in the quantile space, and can help address
over-fitting or local modes in the ABC adaptive waves. <code>widen_by</code> is an odds
ratio and describes how much further from the median any given part of the
distribution is after transformation. E.g. if the median of a distribution
is zero, and the <code>widen_by</code> is 2 then the 0.75 quantile will move to the
position of the 0.9 quantile. The distribution will stay within the
support of the prior. This is by default 1.05 which allows for some
additional variability in proposals.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>an <code>abc_prior</code> S3 object approximating the distribution of the
posterior samples, and adhering to the support of the provided priors.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>This takes weighted posterior samples \(\{(\theta^{(i)}, w^{(i)})\}\)
for each parameter \(\theta_j\) and constructs an empirical distribution
function \(Q_j(\theta_j)\) that approximates the posterior marginal for
that parameter.</p>
<p>For each parameter \(\theta_j\), the empirical distribution \(Q_j\) is
fitted using the <code><a href="empirical.html">empirical()</a></code> function. The fitting is performed on the
weighted samples \((\theta_{j}^{(i)}, w^{(i)})\). A key feature is the use
of a link function \(h_j(\cdot)\) during the fitting process. This link
function is typically taken from the original prior distribution \(P_j(\theta_j)\)
(i.e., \(h_j = P_j\)). This ensures that the fitted empirical distribution
\(Q_j\) respects the support constraints defined by the prior (e.g., positive
values for a log-normal prior). The fitting effectively occurs in the transformed
space defined by the link: \(h_j(\theta_j^{(i)})\).</p>
<p>The resulting empirical distribution \(Q_j\) is a <code>dist_fns</code> object that
includes the support constraints from the original prior. The set of all fitted
marginal distributions \(\{Q_j\}\) forms the new proposal list for the next
wave.</p>
<p>Additionally, the weighted covariance matrix \(R\) of the samples in the
MVN space (defined by the prior copula) is calculated:
$$
  R = \text{Cov}_{w}(\Phi^{-1}(P_1(\theta_1)), \dots, \Phi^{-1}(P_d(\theta_d)))
$$
where \(\Phi^{-1}\) is the quantile function of the standard normal.
This covariance matrix is stored as an attribute (<code>"cor"</code>) of the returned
proposal list and is used to induce correlation structure when sampling
new proposals from the empirical distributions in subsequent waves.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">fit</span> <span class="op">=</span> <span class="fu"><a href="example_fns.html">example_smc_fit</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">proposals</span> <span class="op">=</span> <span class="fu">posterior_fit_empirical</span><span class="op">(</span><span class="va">fit</span><span class="op">$</span><span class="va">posteriors</span>, <span class="va">fit</span><span class="op">$</span><span class="va">priors</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">proposals</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Parameters: </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> * mean: posterior [4.98 ± 0.03]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> * sd1: posterior [1.98 ± 0.08]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> * sd2: posterior [0.99 ± 0.04]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Constraints:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> * mean &gt; sd2</span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Robert Challen.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer></div>





  </body></html>

